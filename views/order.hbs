<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DBMS</title>
    <link href="css/style.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/dataTables.semanticui.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.7.1/css/buttons.semanticui.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/select/1.3.3/css/select.semanticui.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/datetime/1.1.0/css/dataTables.dateTime.min.css">
	<script src="js/app.js"></script>	
	<script src="https://code.jquery.com/jquery-3.1.0.js"></script>
</head>
<body>
	<div class="ui four item menu">
		<a class="item" href="/employee">員工管理</a>
		<a class="item" href="/client">客戶</a>
		<a class="item" href="/supplier">廠商</a>
		<a class="item" href="/order">訂單</a>	
	</div>
	<br>
	<br>
	<br>
	<br>
	<br>
	<div class="ui grid centered">
        <div class="ui stackable secondary menu">   
            <form class="item" method="POST" action="/get-employee-orderUnfinish">
                <button class="ui button">仍有未出貨訂單的業務部員工</button>
            </form>
            <form class="item" method="POST" action="/get-employee-orderfinish">
                <button class="ui button">已處理好所有訂單的業務部員工</button>
            </form>
        </div>            		
		<div class="fourteen wide column" id="table">
			<table class="ui very compact table">
				<thead>
					<tr>
						<th></th>
						<th>訂單編號</th>
						<th>狀態</th>
						<th>下訂日期</th>
                        <th>總金額</th>
 						<th>客戶姓名</th>                       
					</tr>
				</thead>
				<tbody>
                    {{#each data.Order}}
                        <tr class="row_{{OID}}">
                            <td>
                                <i class="edit icon" editOID="{{OID}}" receiveEID="{{ReceiveEID}}" confirmEID="{{ConfirmEID}}"></i>
                            </td>
                            <td>{{OID}}</td>
                            <td>{{CurrentStatus}}</td>
                            <td>{{OrderDate}}</td>
                            <td>{{Total}}元</td>
                            <td address="{{Address}}" phone="{{Phone}}">{{PlaceClient}}</td>
                        </tr>
                    {{/each}}    
									
				</tbody>
			</table>
			<div class="ui button" id="new" style="float: right; width: 10%;">新增</div> 	
			<div id="hide"></div>
		</div>
        <form class="ui form" id="Oform">
			<div class="field">
				<i class="x icon" style="float: right;"></i>
			</div>			
            <div class="three fields">
                <div class="field">
                    <label>訂單編號</label>
                    <input type="text" name="OID">
                </div>
                <div class="field">
                    <label>狀態</label>
                    <select class="ui dropdown" name="status">
                        <option value="未出貨">未出貨</option>
                        <option value="已出貨">已出貨</option>
                    </select>                    
                </div>	
                <div class="field">
                    <label>下訂日期</label>
                    <input type="date" name="orderDate">
                </div>
            </div>
            <div class="three fields">
                <div class="field">
                    <label>客戶姓名</label>
                    <input type="text" name="name">
                </div>
				<div class="field">
					<label>手機號碼</label>
					<input type="text" name="phone">
				</div>
				<div class="field">
					<label>住址</label>
					<input type="text" name="address">
				</div>               	                
            </div>
            <div class="three fields">
				<div class="field">
					<label>接單員工</label>
                    <select class="ui dropdown" name="receive">
					{{#each data.Receive}}	
                        <option value="{{EID}}">{{Name}}</option>
					{{/each}}	
                    </select>    
				</div>
				<div class="field">
					<label>出貨員工</label>
                    <select class="ui dropdown" name="confirm">
					{{#each data.Confirm}}	
                        <option value="{{EID}}">{{Name}}</option>
					{{/each}}	
                    </select>    					
				</div>
                <div class="field">
                    <label>下訂產品種類</label>
                    <div class="ui icon input">
                        <input type="number" name="kind" placeholder="選擇數量">
                        <i class="circular cart plus link icon"></i>
                    </div>
                </div>                	                
            </div>			
            <div id="product_list"></div> 		                							
            <button class="ui button primary" type="submit" style="float: right; width: 15%;" id="submit">確認</button>
            <button class="ui button" type="submit" style="float: right; width: 15%;" id="delete">刪除</button>            
            <input type="hidden" name="query_cond" value="insert">
        </form>
	</div>
	
	
	
	
</body>
<script>
    $(document).ready(function(){	
		$('body').on('click', '.edit', function(){
			let OID = $(this).attr('editOID')
			$('#table').css('display', 'none')
			$('#Oform').css('display', 'block')	
			$('input[name=OID]').val(OID)
			$('select[name=receive]').val($(this).attr('receiveEID'))
			$('select[name=confirm]').val($(this).attr('confirmEID'))
			$('select[name=status]').val($(`.row_${OID} td:nth-child(3)`).html())
			$('input[name=orderDate]').val($(`.row_${OID} td:nth-child(4)`).html())		
			$('input[name=name]').val($(`.row_${OID} td:nth-child(6)`).html())
			$('input[name=phone]').val($(`.row_${OID} td:nth-child(6)`).attr('phone'))
			$('input[name=address]').val($(`.row_${OID} td:nth-child(6)`).attr('address'))   
			$.ajax({
                url: 'get-order-Detail',
                data: {
                    OID: OID
                },
                success: function (data){
					$('input[name=kind]').val(data.length)  
					$('.plus').trigger('click')
					let i = 1
					$.each(data, function (key, value){
						$(`#product_list div:nth-child(${i}) div select`).val(value.PID)
						$(`#product_list div:nth-child(${i}) div input`).val(value.Amount)
						i = i + 1
					})
					$('input').prop('disabled', true)
					$('select').prop('disabled', true)
					if($(`.row_${OID} td:nth-child(3)`).html() == '已出貨'){
						$('.cart').prop('disabled', true)
						$('button').prop('disabled', true)
					}else{
						$('select[name=status]').prop('disabled', false)
						$('select[name=product]').prop('disabled', false)
						$('select[name=confirm]').prop('disabled', false)
						$('input[name=amount]').prop('disabled', false)
						$('input[name=kind]').prop('disabled', false)
					}	         					
                }
            })  			                        	
		})


        $('body').on('click', '#new', function(){
			$('#table').css('display', 'none')
			$('#Oform').css('display', 'block')
        })

        $('body').on('click', '#delete', function(){
			let OID = $('input[name=OID]').val()
            $.ajax({
                url: 'delete-Order',
                data: {
                    OID: OID
                },
                success: function (data){
					$(`.row_${OID}`).remove()
                }
            }) 			
        })


        $('body').on('click', '.x', function(){
			$('#table').css('display', 'block')
			$('#Oform').css('display', 'none')
			clearOform()
        })

		$('body').on('click', '.plus', function(){
			$('#product_list').empty()
			for(let i=0; i<$('input[name=kind]').val(); i++){
				$('#product_list').append(`<div class="two fields">
											<div class="field">
												<label>訂購產品名稱</label>
												<select class="ui dropdown" name="product">
													<option value="1">電視遊樂器</option>
													<option value="2">電視遊樂器搖桿</option>
													<option value="3">電腦外殼</option>
													<option value="4">商用主機</option>
													<option value="5">筆記型電腦</opt6ion>
													<option value="6">鍵盤保護蓋</option>
													<option value="7">無線寬頻分享器</option>
													<option value="8">筆電電池</option>
													<option value="9">掃描器</option>
													<option value="10">主機板</option>
													<option value="11">數位監控卡</option>
													<option value="12">電源供應器</option>
													<option value="13">網路攝影機</option>
													<option value="14">網路線</option>
													<option value="15">行動寶盒</option>
													<option value="16">套裝軟體</option>
													<option value="17">彩色液晶螢幕</option>
													<option value="18">桌上型電腦</option>
													<option value="19">記憶體</option>
													<option value="20">固態硬碟</option>
												
												</select>
											</div>
											<div class="field">
												<label>數量</label>
												<input type="number" name="amount">
											</div>                       
										</div>`)
			}
		})        
	})
</script>
</html>